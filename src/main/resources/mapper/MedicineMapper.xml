<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.seig.backend.mapper.MedicinesMapper">

    <select id="getAllMedicines" resultType="Medicines" >
--         select * from medicines
            select * from medicines where unit = '粒'
    </select>
    <select id="getMedicineById" resultType="Medicines">
        select * from medicines where medicine_id = #{medicineId}
    </select>

    <select id="selectByPrescriptionType" resultType="com.seig.backend.entity.Medicines">
        select * from medicines where is_prescription = #{prescriptionType}
    </select>

    <select id="getNameList" resultType="java.lang.String">
        select generic_name from medicines where is_prescription = 0
    </select>

    <!-- 动态更新药品信息（只更新非空字段,好像有些是空的，改为0开始吧） -->
    <update id="updateMedicine" parameterType="com.seig.backend.entity.Medicines">
        UPDATE medicines
        <set>
            <if test="medicineCode != null">medicine_code = #{medicineCode},</if>
            <if test="genericName != null">generic_name = #{genericName},</if>
            <if test="englishName != null">english_name = #{englishName},</if>
            <if test="chemicalName != null">chemical_name = #{chemicalName},</if>
            <if test="specification != null">specification = #{specification},</if>
            <if test="dosageForm != null">dosage_form = #{dosageForm},</if>
            <if test="categoryId != null">category_id = #{categoryId},</if>
            <if test="manufacturer != null">manufacturer = #{manufacturer},</if>
            <if test="approvalNumber != null">approval_number = #{approvalNumber},</if>
            <if test="isPrescription != null">is_prescription = #{isPrescription},</if>
            <if test="isNarcotic != null">is_narcotic = #{isNarcotic},</if>
            <if test="isPsychotropic != null">is_psychotropic = #{isPsychotropic},</if>
            <if test="isToxic != null">is_toxic = #{isToxic},</if>
            <if test="isHighAlert != null">is_high_alert = #{isHighAlert},</if>
            <if test="storageCondition != null">storage_condition = #{storageCondition},</if>
            <if test="unit != null">unit = #{unit},</if>
            <if test="packageUnit != null">package_unit = #{packageUnit},</if>
            <if test="conversionFactor != null">conversion_factor = #{conversionFactor},</if>
            <if test="minStock != null">min_stock = #{minStock},</if>
            <if test="maxStock != null">max_stock = #{maxStock},</if>
            <if test="description != null">description = #{description},</if>
            <if test="sideEffects != null">side_effects = #{sideEffects},</if>
            <if test="contraindications != null">contraindications = #{contraindications},</if>
            <if test="status != null">status = #{status},</if>
            <if test="updatedBy != null">updated_by = #{updatedBy},</if>
            <!-- updated_at 由数据库自动更新，无需手动设置 -->
        </set>
        WHERE medicine_id = #{medicineId}
    </update>
    <!-- 强制全字段更新（不判断空值，适合需要清空字段的场景，传什么改什么） -->
    <update id="updateMedicineFull" parameterType="com.seig.backend.entity.Medicines">
        UPDATE medicines
        SET
            medicine_code = #{medicineCode},
            generic_name = #{genericName},
            english_name = #{englishName},
            chemical_name = #{chemicalName},
            specification = #{specification},
            dosage_form = #{dosageForm},
            category_id = #{categoryId},
            manufacturer = #{manufacturer},
            approval_number = #{approvalNumber},
            is_prescription = #{isPrescription},
            is_narcotic = #{isNarcotic},
            is_psychotropic = #{isPsychotropic},
            is_toxic = #{isToxic},
            is_high_alert = #{isHighAlert},
            storage_condition = #{storageCondition},
            unit = #{unit},
            package_unit = #{packageUnit},
            conversion_factor = #{conversionFactor},
            min_stock = #{minStock},
            max_stock = #{maxStock},
            description = #{description},
            side_effects = #{sideEffects},
            contraindications = #{contraindications},
            status = #{status},
            updated_by = #{updatedBy}
        WHERE medicine_id = #{medicineId}
    </update>
</mapper>