<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.seig.backend.mapper.WarehouseZoneMapper">

    <resultMap id="BaseResultMap" type="com.seig.backend.entity.storage.WarehouseZone">
        <id column="zone_id" jdbcType="INTEGER" property="zoneId"/>
        <result column="warehouse_id" jdbcType="INTEGER" property="warehouseId"/>
        <result column="zone_code" jdbcType="VARCHAR" property="zoneCode"/>
        <result column="zone_name" jdbcType="VARCHAR" property="zoneName"/>
        <result column="zone_type" jdbcType="TINYINT" property="zoneType"/>
        <result column="gsp_zone_type" jdbcType="TINYINT" property="gspZoneType"/>
        <result column="risk_level" jdbcType="TINYINT" property="riskLevel"/>
        <result column="temperature_min" jdbcType="DECIMAL" property="temperatureMin"/>
        <result column="temperature_max" jdbcType="DECIMAL" property="temperatureMax"/>
        <result column="humidity_min" jdbcType="DECIMAL" property="humidityMin"/>
        <result column="humidity_max" jdbcType="DECIMAL" property="humidityMax"/>
        <result column="current_temp" jdbcType="DECIMAL" property="currentTemp"/>
        <result column="current_humidity" jdbcType="DECIMAL" property="currentHumidity"/>
        <result column="parent_zone_id" jdbcType="INTEGER" property="parentZoneId"/>
        <result column="is_narcotic" jdbcType="TINYINT" property="isNarcotic"/>
        <result column="is_double_lock" jdbcType="TINYINT" property="isDoubleLock"/>
        <result column="is_access_control" jdbcType="TINYINT" property="isAccessControl"/>
        <result column="status" jdbcType="TINYINT" property="status"/>
        <result column="remark" jdbcType="VARCHAR" property="remark"/>
        <result column="created_time" jdbcType="TIMESTAMP" property="createdTime"/>
        <result column="updated_time" jdbcType="TIMESTAMP" property="updatedTime"/>
    </resultMap>

    <sql id="Base_Column_List">
        zone_id
        , warehouse_id, zone_code, zone_name, zone_type,
        gsp_zone_type, risk_level, temperature_min, temperature_max, humidity_min,
        humidity_max, current_temp, current_humidity, parent_zone_id, is_narcotic,
        is_double_lock, is_access_control, status, remark, created_time, updated_time
    </sql>

    <select id="selectById" parameterType="java.lang.Integer" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM warehouse_zone
        WHERE zone_id = #{zoneId}
    </select>

    <select id="selectByWarehouseId" parameterType="java.lang.Integer" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM warehouse_zone
        WHERE warehouse_id = #{warehouseId}
        ORDER BY zone_id DESC
    </select>

    <select id="selectAll" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM warehouse_zone
        ORDER BY zone_id DESC
    </select>

    <insert id="insert" parameterType="com.seig.backend.entity.storage.WarehouseZone" useGeneratedKeys="true"
            keyProperty="zoneId">
        INSERT INTO warehouse_zone
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="warehouseId != null">warehouse_id,</if>
            <if test="zoneCode != null and zoneCode != ''">zone_code,</if>
            <if test="zoneName != null and zoneName != ''">zone_name,</if>
            <if test="zoneType != null">zone_type,</if>
            <if test="gspZoneType != null">gsp_zone_type,</if>
            <if test="riskLevel != null">risk_level,</if>
            <if test="temperatureMin != null">temperature_min,</if>
            <if test="temperatureMax != null">temperature_max,</if>
            <if test="humidityMin != null">humidity_min,</if>
            <if test="humidityMax != null">humidity_max,</if>
            <if test="currentTemp != null">current_temp,</if>
            <if test="currentHumidity != null">current_humidity,</if>
            <if test="parentZoneId != null">parent_zone_id,</if>
            <if test="isNarcotic != null">is_narcotic,</if>
            <if test="isDoubleLock != null">is_double_lock,</if>
            <if test="isAccessControl != null">is_access_control,</if>
            <if test="status != null">status,</if>
            <if test="remark != null and remark != ''">remark,</if>
        </trim>
        <trim prefix="VALUES (" suffix=")" suffixOverrides=",">
            <if test="warehouseId != null">#{warehouseId},</if>
            <if test="zoneCode != null and zoneCode != ''">#{zoneCode},</if>
            <if test="zoneName != null and zoneName != ''">#{zoneName},</if>
            <if test="zoneType != null">#{zoneType},</if>
            <if test="gspZoneType != null">#{gspZoneType},</if>
            <if test="riskLevel != null">#{riskLevel},</if>
            <if test="temperatureMin != null">#{temperatureMin},</if>
            <if test="temperatureMax != null">#{temperatureMax},</if>
            <if test="humidityMin != null">#{humidityMin},</if>
            <if test="humidityMax != null">#{humidityMax},</if>
            <if test="currentTemp != null">#{currentTemp},</if>
            <if test="currentHumidity != null">#{currentHumidity},</if>
            <if test="parentZoneId != null">#{parentZoneId},</if>
            <if test="isNarcotic != null">#{isNarcotic},</if>
            <if test="isDoubleLock != null">#{isDoubleLock},</if>
            <if test="isAccessControl != null">#{isAccessControl},</if>
            <if test="status != null">#{status},</if>
            <if test="remark != null and remark != ''">#{remark},</if>
        </trim>
    </insert>

    <update id="update" parameterType="com.seig.backend.entity.storage.WarehouseZone">
        UPDATE warehouse_zone
        <set>
            <if test="warehouseId != null">warehouse_id = #{warehouseId},</if>
            <if test="zoneCode != null and zoneCode != ''">zone_code = #{zoneCode},</if>
            <if test="zoneName != null and zoneName != ''">zone_name = #{zoneName},</if>
            <if test="zoneType != null">zone_type = #{zoneType},</if>
            <if test="gspZoneType != null">gsp_zone_type = #{gspZoneType},</if>
            <if test="riskLevel != null">risk_level = #{riskLevel},</if>
            <if test="temperatureMin != null">temperature_min = #{temperatureMin},</if>
            <if test="temperatureMax != null">temperature_max = #{temperatureMax},</if>
            <if test="humidityMin != null">humidity_min = #{humidityMin},</if>
            <if test="humidityMax != null">humidity_max = #{humidityMax},</if>
            <if test="currentTemp != null">current_temp = #{currentTemp},</if>
            <if test="currentHumidity != null">current_humidity = #{currentHumidity},</if>
            <if test="parentZoneId != null">parent_zone_id = #{parentZoneId},</if>
            <if test="isNarcotic != null">is_narcotic = #{isNarcotic},</if>
            <if test="isDoubleLock != null">is_double_lock = #{isDoubleLock},</if>
            <if test="isAccessControl != null">is_access_control = #{isAccessControl},</if>
            <if test="status != null">status = #{status},</if>
            <if test="remark != null and remark != ''">remark = #{remark},</if>
            updated_time = NOW()
        </set>
        WHERE zone_id = #{zoneId}
    </update>

    <delete id="deleteById" parameterType="java.lang.Integer">
        DELETE
        FROM warehouse_zone
        WHERE zone_id = #{zoneId}
    </delete>

<!--    仓库的温度不能低于药物温度，不能高于药物温度-->
    <select id="selectByTemperatureRange" resultType="int">
        SELECT zone_id
        FROM warehouse_zones
        WHERE warehouse_id = #{warehouseId}
        AND min_temperature &gt;= #{minTemperature}   <!-- 仓库低温 >= 2°C -->
        AND max_temperature &lt;= #{maxTemperature}   <!-- 仓库高温 <= 8°C -->
    </select>

</mapper>
